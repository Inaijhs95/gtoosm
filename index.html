<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>スロットゲーム</title>
  <!-- スマホ対応 -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    /* ベースリセット */
    * {
      box-sizing: border-box;
      margin: 0; 
      padding: 0;
    }
    body {
      background: #444; 
      color: #fff;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    /* スロット台の外枠 */
    .slot-machine {
      width: 320px;
      background: #222;
      border: 6px solid #000;
      border-radius: 10px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.8);
      position: relative;
      overflow: hidden;
    }

    /* 上部ディスプレイ部分：メッセージや回転数表示、当たり演出をここに出す */
    .slot-display {
      background: #111;
      padding: 10px;
      height: 100px;
      border-bottom: 3px solid #000;
      position: relative;
    }
    .slot-display h2 {
      font-size: 1.2em;
      margin-bottom: 5px;
    }
    .slot-display p {
      font-size: 1em;
    }
    #displayMessage {
      margin: 5px 0;
      min-height: 20px; /* メッセージの高さ確保 */
    }
    /* 大当たり時のみ表示する画像 */
    #winImage {
      display: none;
      width: 80px;
      margin: 0 auto;
    }

    /* リール部分 */
    .reels {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 15px;
      background: linear-gradient(to bottom, #555, #333);
    }
    .reel {
      width: 60px;
      height: 60px;
      margin: 0 5px;
      font-size: 2em;
      background: #fff;
      color: #000;
      text-align: center;
      line-height: 60px;
      border-radius: 8px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.5) inset;
    }

    /* 下部コントロール部分 */
    .controls {
      background: #222;
      padding: 15px 10px 20px;
      display: flex;
      flex-direction: column; 
      align-items: center;
    }

    /* レバー(黒背景にシルバーの棒風) */
    .lever-container {
      position: relative;
      width: 80px;
      height: 80px;
      margin-bottom: 15px;
    }
    .lever-base {
      width: 80px;
      height: 80px;
      background: radial-gradient(#222, #000);
      border-radius: 50%;
      box-shadow: 0 0 6px rgba(0,0,0,0.8) inset, 0 3px 6px rgba(0,0,0,0.5);
      position: relative;
      cursor: pointer;
      user-select: none;
    }
    /* シルバーの金属棒を疑似要素で表現 */
    .lever-base::before {
      content: "";
      position: absolute;
      top: -60px; 
      left: 37px;  /* 中心より少しずらす */
      width: 6px;
      height: 60px;
      background: linear-gradient(#bbb, #777);
      border-radius: 3px;
      box-shadow: 0 0 3px rgba(0,0,0,0.5);
      transition: transform 0.2s ease;
      transform-origin: bottom center;
    }
    /* レバー押し下げ時の動き */
    .lever-base:active::before {
      transform: rotate(40deg);
    }

    /* ストップボタン(赤色) */
    .stop-buttons {
      display: flex;
      gap: 5px;
    }
    .stop-btn {
      width: 60px;
      height: 60px;
      border-radius: 10px;
      border: 2px solid #aa0000;
      background: linear-gradient(to bottom, #ff5555, #bb0000);
      color: #fff;
      font-size: 0.8em;
      font-weight: bold;
      box-shadow: 0 0 4px rgba(0,0,0,0.8) inset, 0 3px 6px rgba(0,0,0,0.4);
      cursor: pointer;
    }
    .stop-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .stop-btn:active {
      transform: translateY(2px);
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.6);
    }
  </style>
</head>
<body>

  <div class="slot-machine">
    <!-- 上部ディスプレイ -->
    <div class="slot-display">
      <h2>スロットゲーム</h2>
      <!-- 回転数を表示する要素 -->
      <p id="spinCountText"></p>
      <!-- メッセージや当たり演出を表示する部分 -->
      <div id="displayMessage"></div>
      <!-- 大当たり時にだけ表示する画像 -->
      <img src="osm.png" alt="Win Image" id="winImage">
    </div>

    <!-- リール -->
    <div class="reels">
      <div class="reel" id="reel1">0</div>
      <div class="reel" id="reel2">0</div>
      <div class="reel" id="reel3">0</div>
    </div>

    <!-- レバー＆ボタン類 -->
    <div class="controls">
      <!-- レバー -->
      <div class="lever-container">
        <div class="lever-base" id="lever"></div>
      </div>

      <!-- ストップボタン -->
      <div class="stop-buttons">
        <button class="stop-btn" id="stop1" disabled>STOP<br>1</button>
        <button class="stop-btn" id="stop2" disabled>STOP<br>2</button>
        <button class="stop-btn" id="stop3" disabled>STOP<br>3</button>
      </div>
    </div>
  </div>

  <script>
    // ---- DOM要素取得 ----
    const reel1 = document.getElementById('reel1');
    const reel2 = document.getElementById('reel2');
    const reel3 = document.getElementById('reel3');

    const lever = document.getElementById('lever');
    const stopBtn1 = document.getElementById('stop1');
    const stopBtn2 = document.getElementById('stop2');
    const stopBtn3 = document.getElementById('stop3');

    const displayMessage = document.getElementById('displayMessage');
    const spinCountText = document.getElementById('spinCountText');
    const winImage = document.getElementById('winImage');

    // ---- 回転関連変数 ----
    let reelInterval1, reelInterval2, reelInterval3;
    let spinning1 = false, spinning2 = false, spinning3 = false;

    // ---- 回転数をlocalStorageで管理 ----
    let spinCount = parseInt(localStorage.getItem('slotSpinCount') || '0', 10);
    updateSpinCountDisplay();

    function updateSpinCountDisplay() {
      spinCountText.textContent = `回転数：${spinCount}`;
    }

    // ---- レバーを押したとき ----
    lever.addEventListener('click', () => {
      if (!spinning1 && !spinning2 && !spinning3) {
        // 回転数をカウントアップして保存
        spinCount++;
        localStorage.setItem('slotSpinCount', spinCount);
        updateSpinCountDisplay();

        // メッセージや画像をリセット
        displayMessage.textContent = "";
        winImage.style.display = "none";

        // レバー・ストップボタンの制御
        stopBtn1.disabled = false;
        stopBtn2.disabled = false;
        stopBtn3.disabled = false;

        // リールを回し始める
        spinning1 = true;
        spinning2 = true;
        spinning3 = true;

        reelInterval1 = setInterval(() => {
          reel1.textContent = Math.floor(Math.random() * 8); // 0～7
        }, 100);
        reelInterval2 = setInterval(() => {
          reel2.textContent = Math.floor(Math.random() * 8);
        }, 100);
        reelInterval3 = setInterval(() => {
          reel3.textContent = Math.floor(Math.random() * 8);
        }, 100);
      }
    });

    // ---- ストップボタン ----
    stopBtn1.addEventListener('click', () => stopReel(1));
    stopBtn2.addEventListener('click', () => stopReel(2));
    stopBtn3.addEventListener('click', () => stopReel(3));

    function stopReel(reelNumber) {
      if (reelNumber === 1 && spinning1) {
        clearInterval(reelInterval1);
        spinning1 = false;
        stopBtn1.disabled = true;
      }
      if (reelNumber === 2 && spinning2) {
        clearInterval(reelInterval2);
        spinning2 = false;
        stopBtn2.disabled = true;
      }
      if (reelNumber === 3 && spinning3) {
        clearInterval(reelInterval3);
        spinning3 = false;
        stopBtn3.disabled = true;
      }
      // 全リールが止まったか確認
      if (!spinning1 && !spinning2 && !spinning3) {
        checkResult();
      }
    }

    // ---- 結果判定 ----
    function checkResult() {
      const val1 = parseInt(reel1.textContent, 10);
      const val2 = parseInt(reel2.textContent, 10);
      const val3 = parseInt(reel3.textContent, 10);

      // 0,3,6が揃ったら50%の確率で当たり
      if (val1 === 0 && val2 === 3 && val3 === 6) {
        if (Math.random() < 0.5) {
          // 大当たり演出
          showJackpot();
        } else {
          // ハズレ演出
          displayMessage.textContent = "ハズレ...なんぼでも挑戦可能！狙うはあの数字？";
        }
      } else {
        // 0,3,6が出なかった場合
        displayMessage.textContent = "ハズレ...なんぼでも挑戦可能！狙うはあの数字？";
      }
    }

    // ---- 大当たり演出 ----
    function showJackpot() {
      displayMessage.textContent = "大当たり！！";
      winImage.style.display = "block"; // osm.png 表示
      // 回転数リセット
      spinCount = 0;
      localStorage.setItem('slotSpinCount', spinCount);
      updateSpinCountDisplay();
    }
  </script>
</body>
</html>
