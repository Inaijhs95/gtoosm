<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>03.6％の奇跡 - スロットマシン版</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"
    rel="stylesheet"
  />
  <style>
    /* 全体のスタイル */
    body {
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #1e3c72, #2a5298);
      font-family: 'Roboto', sans-serif;
      color: #ffffff;
      overflow: hidden;
      position: relative;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    /* スロットマシンのコンテナ */
    .content {
      position: relative;
      text-align: center;
      z-index: 1;
    }

    /* スロット配置 */
    .slot-container {
      display: flex;
      justify-content: center;
      align-items: flex-end;
      gap: 40px;
      position: relative;
      margin-bottom: 50px;
    }

    .slot {
      width: 100px;
      height: 150px;
      border: 5px solid #fff;
      border-radius: 10px;
      overflow: hidden;
      background: #000;
      position: relative;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .slot-inner {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 900px; /* 6 * 150 */
      transition: transform 0.5s ease-out;
    }
    .slot-item {
      width: 100%;
      height: 150px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 3em;
      background: #333;
      color: #fff;
      border-bottom: 2px solid #555;
    }

    /* 各リール下のストップボタン */
    .stop-button {
      width: 40px;
      height: 40px;
      background-color: red;
      border: 2px solid #fff;
      border-radius: 50%;
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      bottom: -60px;
      cursor: pointer;
      z-index: 2;
      transition: transform 0.2s;
    }
    .stop-button:hover {
      transform: translateX(-50%) scale(1.1);
    }

    /* レバー (左端に固定) */
    .lever {
      position: absolute;
      left: -70px;
      bottom: 0;
      width: 40px;
      height: 100px;
      background: linear-gradient(to bottom, #555, #111);
      border: 3px solid #fff;
      border-radius: 10px;
      cursor: pointer;
      box-shadow: 0 5px 15px rgba(0,0,0,0.5);
      transform-origin: bottom center;
      transition: transform 0.3s ease-out;
    }
    .lever:before {
      content: '';
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      width: 30px;
      height: 30px;
      background: radial-gradient(circle, #ff5722, #e64a19);
      border: 2px solid #fff;
      border-radius: 50%;
    }
    .lever.pull {
      animation: pullLever 0.4s forwards;
    }
    @keyframes pullLever {
      0% { transform: rotate(0deg); }
      50% { transform: rotate(-30deg); }
      100% { transform: rotate(0deg); }
    }

    /* 当たったときの光り方 */
    .hit-flash {
      animation: bigFlash 1s infinite alternate;
    }
    @keyframes bigFlash {
      from { box-shadow: 0 0 10px 5px #ffff66; }
      to   { box-shadow: 0 0 30px 20px #ffeb3b; }
    }

    /* レスポンシブ */
    @media(max-width: 600px) {
      .slot-container {
        gap: 10px;
      }
      .slot {
        width: 70px;
        height: 100px;
      }
      .slot-inner {
        height: 600px; /* 6 * 100 */
      }
      .slot-item {
        height: 100px;
        font-size: 2em;
      }
      .stop-button {
        width: 30px;
        height: 30px;
        bottom: -40px;
      }
      .lever {
        left: -55px;
        width: 30px;
        height: 80px;
      }
    }
  </style>
</head>
<body>
  <div class="content">
    <h1>03.6％の奇跡 - スロットマシン版</h1>

    <div class="slot-container">
      <!-- レバー -->
      <div class="lever" id="lever"></div>

      <!-- リール1 -->
      <div class="slot" id="slot0">
        <div class="slot-inner">
          <div class="slot-item">0</div>
          <div class="slot-item">1</div>
          <div class="slot-item">2</div>
          <div class="slot-item">3</div>
          <div class="slot-item">4</div>
          <div class="slot-item">5</div>
        </div>
        <div class="stop-button" id="stop0"></div>
      </div>
      <!-- リール2 -->
      <div class="slot" id="slot1">
        <div class="slot-inner">
          <div class="slot-item">0</div>
          <div class="slot-item">1</div>
          <div class="slot-item">2</div>
          <div class="slot-item">3</div>
          <div class="slot-item">4</div>
          <div class="slot-item">5</div>
        </div>
        <div class="stop-button" id="stop1"></div>
      </div>
      <!-- リール3 （6を入れる）-->
      <div class="slot" id="slot2">
        <div class="slot-inner">
          <div class="slot-item">0</div>
          <div class="slot-item">1</div>
          <div class="slot-item">2</div>
          <div class="slot-item">3</div>
          <div class="slot-item">6</div> <!-- ここを6に！ -->
          <div class="slot-item">5</div>
        </div>
        <div class="stop-button" id="stop2"></div>
      </div>
    </div>
  </div>

  <script>
    // リール
    const slots = [
      document.getElementById('slot0'),
      document.getElementById('slot1'),
      document.getElementById('slot2'),
    ];

    // ストップボタン
    const stopButtons = [
      document.getElementById('stop0'),
      document.getElementById('stop1'),
      document.getElementById('stop2'),
    ];

    // レバー
    const lever = document.getElementById('lever');

    let isSpinning = false;
    let results = [null, null, null];
    const reelHeight = 150;
    const reelCount = 6;
    let spinIntervals = [null, null, null];
    const currentPositions = [0, 0, 0];

    // レバーをクリックしたら回転開始
    lever.addEventListener('click', () => {
      if (isSpinning) return;
      lever.classList.add('pull'); // レバー引くアニメ
      startSpinning();
      setTimeout(() => lever.classList.remove('pull'), 500);
    });

    // 回転開始
    function startSpinning() {
      isSpinning = true;
      results = [null, null, null];

      // ボタンを表示・有効化
      stopButtons.forEach((btn) => {
        btn.style.display = 'block';
        btn.disabled = false;
      });

      // 各リールをぐるぐる
      slots.forEach((slot, index) => {
        const slotInner = slot.querySelector('.slot-inner');
        // 既にインターバル動いていれば止める
        if (spinIntervals[index]) clearInterval(spinIntervals[index]);

        spinIntervals[index] = setInterval(() => {
          currentPositions[index] = (currentPositions[index] + 1) % reelCount;
          slotInner.style.transform = `translateY(${-reelHeight * currentPositions[index]}px)`;
        }, 30); // 30ms間隔 → 高速
      });
    }

    // リールを停止
    function stopReel(index) {
      if (!isSpinning || results[index] !== null) return;

      // 動いてるインターバルをクリア
      clearInterval(spinIntervals[index]);
      spinIntervals[index] = null;

      // 既に currentPositions[index] に値があるのでそのまま停止
      const stopPos = currentPositions[index];
      results[index] = slots[index].querySelector('.slot-inner')
                        .children[stopPos].textContent;

      // アニメーションで止める演出
      const slotInner = slots[index].querySelector('.slot-inner');
      slotInner.style.transition = 'transform 0.7s ease-out';
      slotInner.style.transform = `translateY(${-reelHeight * stopPos}px)`;

      // このボタンを無効化
      stopButtons[index].disabled = true;

      // 全部止まったかチェック
      if (results.every((val) => val !== null)) {
        checkResult();
      }
    }

    // 結果をチェック
    function checkResult() {
      const combined = results.join('');
      console.log('結果:', combined);

      if (combined === '036') {
        // 当たり
        slots.forEach((s) => s.classList.add('hit-flash'));

        setTimeout(() => {
          slots.forEach((s) => s.classList.remove('hit-flash'));
          window.location.href =
            'https://line.me/R/oaMessage/%40778unfqy/%E3%83%A1%E3%83%A2%E3%81%AE%E8%AC%8E%E3%80%81%E8%A7%A3%E3%81%91%E3%81%BE%E3%81%97%E3%81%9F';
        }, 2000);
      } else {
        alert('なんぼでも挑戦可能！狙うはあの数字？');
      }

      // リセット
      isSpinning = false;
      stopButtons.forEach((btn) => {
        btn.style.display = 'none';
        btn.disabled = false;
      });
      slots.forEach((slot) => {
        slot.querySelector('.slot-inner').style.transition = 'transform 0.5s ease-out';
      });
    }

    // ストップボタンにイベント
    stopButtons.forEach((btn, i) => {
      btn.addEventListener('click', () => stopReel(i));
    });
  </script>
</body>
</html>
